<ng-container *ngIf="data$ | async as data">
    <a class="float-end btn btn-light" *ngIf="data.source.editable"
        [routerLink]="['/data-entry/sources', data.source.id]">
        <lc-icon [icon]="actionIcons.edit" />
        Edit this source
    </a>

    <lc-breadcrumb [breadcrumbs]="makeBreadcrumbs(data)" />

    <h1>
        <lc-icon [icon]="dataIcons.source"/>
        {{data.source.name}}
    </h1>

    <p>
        {{data.source.name}} is one of the source texts that have been analysed in the
        Lettercraft project.
    </p>

    <p *ngIf="data.source.contributors.length">
        <b>Contributors:</b>
        <ng-container *ngFor="let user of data.source.contributors; last as isLast">
            {{user.fullName}}<ng-container *ngIf="!isLast">, </ng-container>
        </ng-container>
    </p>

    <div class="card mb-4 mt-4">
        <div class="card-body">
            <h2 class="h5 card-title">Bibliographical information</h2>

            <ng-container *ngIf="data.source.medievalAuthor || data.source.medievalTitle">
                {{ data.source.medievalAuthor }}<ng-container *ngIf="data.source.medievalAuthor && data.source.medievalTitle">, </ng-container><em>{{ data.source.medievalTitle }}</em>.
            </ng-container>
            <ng-container *ngIf="data.source.editionAuthor || data.source.editionTitle">
                (Ed. {{ data.source.editionAuthor }}<ng-container *ngIf="data.source.editionAuthor && data.source.editionTitle">, </ng-container>{{ data.source.editionTitle }}.)
            </ng-container>

        </div>
    </div>

    <h2 class="mb-4">Episodes</h2>

    <div class="card mb-4" *ngFor="let episode of data.source.episodes">
        <div class="card-header position-relative">
            <a class="icon-link stretched-link"
                [routerLink]="['/data/episodes', episode.id]">
                <lc-icon [icon]="dataIcons.episode" />
                {{episode.name}}
            </a>
            <br />
            <small *ngIf="episode.book || episode.chapter || episode.page" class="inline-list">
                <span *ngIf="episode.book" class="inline-list-item">book {{ episode.book }}</span>
                <span *ngIf="episode.chapter" class="inline-list-item">chapter {{ episode.chapter }}</span>
                <span *ngIf="episode.page" class="inline-list-item">page {{ episode.page }}</span>
            </small>
        </div>
        <div class="card-body">
            <p *ngIf="episode.summary">{{episode.summary}}</p>

            <dl>
                <dt>Agents</dt>
                <dd *ngIf="episode.agents.length > 0; else noAgents" class="ms-4">
                    <ul class="inline-list">
                        <li
                            *ngFor="let agent of episode.agents"
                            class="inline-list-item"
                        >
                            <a
                                [routerLink]="['/data', 'agents', agent.id]"
                                class="icon-link"
                            >
                                <lc-icon [icon]="agentIcon(agent)" />
                                {{ agent.name }}
                            </a>
                        </li>
                    </ul>
                </dd>
                <ng-template #noAgents>
                    <dd class="ms-4">None.</dd>
                </ng-template>

                <dt>Locations</dt>
                <dd *ngIf="episode.spaces.length > 0; else noSpaces" class="ms-4">
                    <ul class="inline-list">
                        <li
                            *ngFor="let space of episode.spaces"
                            class="inline-list-item"
                        >
                            <a
                                [routerLink]="['/data', 'locations', space.id]"
                                class="icon-link"
                            >
                                <lc-icon [icon]="locationIcon(space)" />
                                {{ space.name }}
                            </a>
                        </li>
                    </ul>
                </dd>
                <ng-template #noSpaces>
                    <dd class="ms-4">None.</dd>
                </ng-template>

                <dt>Objects</dt>
                <dd
                    *ngIf="
                        episode.gifts.length > 0 || episode.letters.length > 0;
                        else noObjects
                    "
                    class="ms-4"
                >
                    <ul class="inline-list">
                        <li
                            *ngFor="let gift of episode.gifts"
                            class="inline-list-item"
                        >
                            <a
                                [routerLink]="['/data', 'gifts', gift.id]"
                                class="icon-link"
                            >
                                <lc-icon [icon]="dataIcons.gift" />
                                {{ gift.name }}
                            </a>
                        </li>
                        <li
                            *ngFor="let letter of episode.letters"
                            class="inline-list-item"
                        >
                            <a
                                [routerLink]="['/data', 'letters', letter.id]"
                                class="icon-link"
                            >
                                <lc-icon [icon]="dataIcons.letter" />
                                {{ letter.name }}
                            </a>
                        </li>
                    </ul>
                </dd>
                <ng-template #noObjects>
                    <dd class="ms-4">None.</dd>
                </ng-template>
            </dl>
        </div>
    </div>
</ng-container>
