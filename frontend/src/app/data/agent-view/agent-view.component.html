<ng-container *ngIf="data$ | async as data; else loading">
    <ng-container *ngIf="data.agentDescription as agent; else notFound">
        <a class="float-end btn btn-light" *ngIf="agent.editable"
            [routerLink]="['/data-entry/agents', agent.id]">
            <lc-icon [icon]="actionIcons.edit" />
            Edit this agent
        </a>

        <lc-breadcrumb [breadcrumbs]="makeBreadcrumbs(agent)" />

        <lc-object-page-header [object]="data.agentDescription"
            [icon]="agentIcon(data.agentDescription)" />

        <lc-contributors [contributors]="agent.contributors" />

        <section class="mt-5">
            <h2>Description</h2>

            <dl>
                <dt>Individual or group</dt>
                <dd class="ms-4">
                    {{ agent.isGroup ? 'Group' : 'Individual' }}
                </dd>

                <dt *ngIf="agent.gender">Gender</dt>
                <dd *ngIf="agent.gender as gender" class="ms-4">
                    <p>
                        {{gender.gender | lowercase}}
                        ({{gender.sourceMention | lowercase}})
                    </p>
                    <p *ngIf="gender.note">
                        <small><i>Note: {{gender.note}} </i></small>
                    </p>
                </dd>
            </dl>
        </section>

        <section class="mt-5">
            <h2>Source text</h2>

            <p>
                {{agent.name}} is an agent in
                <a [routerLink]="['/data/sources', agent.source.id]" class="icon-link">
                    <lc-icon [icon]="dataIcons.source" />
                    {{agent.source.name}}
                </a>.
                <ng-container *ngIf="agent.episodes.length">
                    <ng-container [ngSwitch]="agent.gender?.gender">
                        <ng-container *ngSwitchCase="Gender.Male">He appears</ng-container>
                        <ng-container *ngSwitchCase="Gender.Female">She appears</ng-container>
                        <ng-container *ngSwitchDefault>They appear</ng-container>
                    </ng-container>
                    in the following episodes:
                </ng-container>
            </p>

            <lc-episode-links [data]="agent.episodes" />
        </section>

        <section class="mt-5">
            <h2>Historical context</h2>

            <ng-container *ngIf="agent.personReferences.length; else noReferences">
                <ng-container *ngIf="agent.isGroup; else singularReference">
                    <p>
                        This group includes the following historical figures:
                    </p>
                    <ul>
                        <li *ngFor="let ref of agent.personReferences">
                            <a [routerLink]="['/data/historical-figures', ref.person.id]">{{ref.person.name}}</a>
                            <ng-container *ngIf="ref.certainty === Certainty.SomewhatCertain">(somewhat certain)</ng-container>
                            <ng-container *ngIf="ref.certainty === Certainty.Uncertain">(uncertain)</ng-container>
                            <ng-container *ngIf="ref.note">; <i>Note: {{ref.note}}</i></ng-container>
                        </li>
                    </ul>
                </ng-container>
                <ng-template #singularReference>
                    <ng-container *ngIf="agent.personReferences[0] as ref">
                        <p>
                            This agent is a representation of
                            <a [routerLink]="['/data/historical-figures', ref.person.id]">
                                {{ref.person.name}}</a>
                            <ng-container *ngIf="ref.certainty === Certainty.SomewhatCertain">
                                (somewhat certain)
                            </ng-container>
                            <ng-container *ngIf="ref.certainty === Certainty.Uncertain">
                                (uncertain)
                            </ng-container>.
                            <i *ngIf="ref.note">Note: {{ref.note}}</i>
                        </p>
                    </ng-container>
                </ng-template>
            </ng-container>

            <ng-template #noReferences>
                <p><i>
                    This agent is not linked to any historic figures in the database.
                </i></p>
            </ng-template>
        </section>
    </ng-container>
</ng-container>

<ng-template #loading>
    <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</ng-template>

<ng-template #notFound>
    <lc-breadcrumb [breadcrumbs]="notFoundBreadcrumbs" />
    <lc-not-found/>
</ng-template>
