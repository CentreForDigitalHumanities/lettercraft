<ng-container *ngIf="data$ | async as data">
    <a class="float-end btn btn-light" *ngIf="data.episode?.editable"
        [routerLink]="['/data-entry/episodes', data.episode?.id]">
        <lc-icon [icon]="actionIcons.edit" />
        Edit this episode
    </a>

    <lc-breadcrumb [breadcrumbs]="makeBreadcrumbs(data)" />

    <ng-container *ngIf="data.episode as episode">
        <lc-object-page-header [object]="episode" [icon]="dataIcons.episode" />

        <p>
            "{{ episode.name }}" is an epistolary episode in
            <a [routerLink]="['/data/sources', episode.source.id]" class="icon-link">
                <lc-icon [icon]="dataIcons.source" />
                {{episode.source.name}}</a>.
        </p>

        <lc-contributors [contributors]="episode.contributors" />

        <h2 class="mt-5">Source text</h2>

        <dl>
            <dt>Source text</dt>
            <dd class="ms-4">
                <a [routerLink]="['/data/sources', episode.source.id]" class="icon-link">
                    <lc-icon [icon]="dataIcons.source" />
                    {{episode.source.name}}</a>
            </dd>
            <dt>Location in text</dt>
            <dd class="ms-4">
                <span class="inline-list">
                    <span *ngIf="episode.book" class="inline-list-item">book {{ episode.book }}</span>
                    <span *ngIf="episode.chapter" class="inline-list-item">chapter {{ episode.chapter }}</span>
                    <span *ngIf="episode.page" class="inline-list-item">page {{ episode.page }}</span>
                </span>
                <i *ngIf="!(episode.book || episode.chapter || episode.page)">
                    Location not specified.
                </i>
            </dd>
        </dl>

        <h2 class="mt-5">Content</h2>

        <dl>
            <dt>Summary</dt>
            <dd style="white-space: pre-line;" class="ms-4">{{ episode.summary }}</dd>

            <dt>Designators</dt>
            <dd class="ms-4">
                <ul class="inline-list" *ngIf="episode.designators.length; else noDesignators">
                    <li *ngFor="let designator of episode.designators" class="inline-list-item">
                        {{designator}}
                    </li>
                </ul>
                <ng-template #noDesignators>None.</ng-template>
            </dd>

            <dt>Labels</dt>
            <dd class="ms-4">
                <ul class="inline-list no-delimiter">
                    <li *ngFor="let category of episode.categories"
                        class="inline-list-item">
                        <span class="badge rounded-pill text-bg-secondary">
                            {{category.name}}
                        </span>
                    </li>
                </ul>
            </dd>
        </dl>

        <h2 class="mt-5">Agents</h2>

        <p>
            This episode involves the following agents:
        </p>

        <ul class="list-group">
            <li class="list-group-item" *ngFor="let link of episode.agents">
                <a [routerLink]="['/data/agents', link.agent.id]" class="icon-link">
                    <lc-icon [icon]="agentIcon(link.agent)" />
                    {{link.agent.name}}
                </a>
            </li>
        </ul>

        <h2 class="mt-5">Objects</h2>

        <p>This episode involves the following epistolary objects:</p>

        <ul class="list-group">
            <li class="list-group-item" *ngFor="let link of episode.letters">
                <a [routerLink]="['/data/letters', link.letter.id]" class="icon-link">
                    <lc-icon [icon]="dataIcons.letter" />
                    {{link.letter.name}}
                </a>
            </li>
            <li class="list-group-item" *ngFor="let link of episode.gifts">
                <a [routerLink]="['/data/gifts', link.gift.id]" class="icon-link">
                    <lc-icon [icon]="dataIcons.gift" />
                    {{link.gift.name}}
                </a>
            </li>
        </ul>

        <h2 class="mt-5">Locations</h2>

        <p>
            This episode involves the following locations:
        </p>

        <ul class="list-group">
            <li class="list-group-item" *ngFor="let link of episode.spaces">
                <a [routerLink]="['/data/locations', link.space.id]" class="icon-link">
                    <lc-icon [icon]="locationIcon(link.space)" />
                    {{link.space.name}}
                </a>
            </li>
        </ul>
    </ng-container>
</ng-container>
